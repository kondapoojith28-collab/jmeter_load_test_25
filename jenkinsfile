pipeline {
    agent any

    environment {
        IMAGE_NAME = 'poojith02/jmetertest:v1.0'  // Your Docker image name
        TEST_REPO = 'https://github.com/kondapoojith28-collab/jmeter_load_test_25.git'  // Your GitHub repo URL
    }

    stages {
        stage('Checkout Tests') {
            steps {
                // Clone your test scripts repository with credentials
                git branch: 'main', credentialsId: "${params.gitCredentialsID}", url: "${TEST_REPO}"
            }
        }
        
        stage('Run JMeter Tests') {
            steps {
                // Use bat instead of sh and adjust volume mount for Windows PowerShell syntax
                bat """
                docker run --rm -v %cd%\\:/tests -w /tests ${IMAGE_NAME} ^
                -n -t Merge_Sprint.jmx -l results.jtl -e -o result.html
                """
            }
        }

        stage('Archive Results') {
            steps {
                archiveArtifacts artifacts: '/results.jtl, report/**', allowEmptyArchive: true
            }
        }
    }
}
